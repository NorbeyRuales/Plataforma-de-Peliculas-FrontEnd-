<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>routes/AppRouter.tsx - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#AGE_MAX">AGE_MAX</a></li><li><a href="global.html#AGE_MIN">AGE_MIN</a></li><li><a href="global.html#AppRouter">AppRouter</a></li><li><a href="global.html#Breadcrumbs">Breadcrumbs</a></li><li><a href="global.html#DelayedFallback">DelayedFallback</a></li><li><a href="global.html#EMAIL_KEY">EMAIL_KEY</a></li><li><a href="global.html#FooterSwitcher">FooterSwitcher</a></li><li><a href="global.html#GuestOnly">GuestOnly</a></li><li><a href="global.html#Header">Header</a></li><li><a href="global.html#Home">Home</a></li><li><a href="global.html#LABELS">LABELS</a></li><li><a href="global.html#Login">Login</a></li><li><a href="global.html#MovieCard">MovieCard</a></li><li><a href="global.html#MovieDetail">MovieDetail</a></li><li><a href="global.html#PRELOAD_MARGIN">PRELOAD_MARGIN</a></li><li><a href="global.html#Protected">Protected</a></li><li><a href="global.html#Register">Register</a></li><li><a href="global.html#calcStars">calcStars</a></li><li><a href="global.html#clearToken">clearToken</a></li><li><a href="global.html#getRandomPexelsVideo">getRandomPexelsVideo</a></li><li><a href="global.html#guessPoster">guessPoster</a></li><li><a href="global.html#isAuthed">isAuthed</a></li><li><a href="global.html#isMovieArray">isMovieArray</a></li><li><a href="global.html#pathToLabel">pathToLabel</a></li><li><a href="global.html#useDelayedVisible">useDelayedVisible</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">routes/AppRouter.tsx</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @file AppRouter.tsx
 * @description Main application router and layout composition (Header, Breadcrumbs, Footer).
 * Includes WCAG helpers: Skip Link (2.4.1), visible focus styles (2.4.7 via global CSS),
 * and a minimal Suspense fallback with an optional delay.
 */

import { BrowserRouter, Routes, Route, Navigate, useLocation } from 'react-router-dom'
import { Suspense, useEffect, useState } from 'react'
import Header from '../components/layout/Header'
import Footer from '../components/layout/Footer'

import Home from '../pages/home/Home'
import Movies from '../pages/movies/Movies'
import MovieDetail from '../pages/movie/MovieDetail'
import Login from '../pages/login/Login'
import Register from '../pages/register/Register'
import ForgotPassword from '../pages/forgot-password/ForgotPassword'
import Account from '../pages/account/Account'
import Favorites from '../pages/favorites/Favorites'
import About from '../pages/about/About'
import SiteMap from '../site-map/SiteMap'

import AuthCallback from '../pages/auth-callback/AuthCallback'
import { hasSupabaseAuthParams } from '../utils/authUrl'
import ResetPassword from '../pages/reset-password/ResetPassword'

import Breadcrumbs from '../components/Breadcrumbs/Breadcrumbs'
import SkipLink from '../components/a11y/SkipLink'

/**
 * Checks if the user is authenticated based on a persisted token.
 * NOTE: this is a minimal client-side gate; the server/API must also validate.
 * @returns {boolean} True when a token exists in localStorage.
 */
const isAuthed = () => !!localStorage.getItem('token')

/**
 * Wrapper for private (authenticated) routes.
 * If the user is not authenticated, navigates to /login, preserving the origin in state.
 * Supabase auth callback routes are always allowed to pass through.
 * @param {{ children: JSX.Element }} props
 * @returns {JSX.Element}
 */
function Protected({ children }: { children: JSX.Element }) {
  const location = useLocation()
  if (hasSupabaseAuthParams()) return children
  return isAuthed() ? children : &lt;Navigate to="/login" replace state={{ from: location }} />
}

/**
 * Wrapper for guest-only routes (Login/Register).
 * If the user is already authenticated, redirects to the home page.
 * Supabase auth callback routes are always allowed to pass through.
 * @param {{ children: JSX.Element }} props
 * @returns {JSX.Element}
 */
function GuestOnly({ children }: { children: JSX.Element }) {
  const location = useLocation()
  if (hasSupabaseAuthParams()) return children
  return isAuthed() ? &lt;Navigate to="/" replace state={{ from: location }} /> : children
}

/**
 * Renders the global footer except on public auth screens.
 * @returns {JSX.Element | null}
 */
function FooterSwitcher() {
  const { pathname } = useLocation()
  const hide = ['/login', '/register', '/forgot-password', '/reset-password'].includes(pathname)
  return hide ? null : &lt;Footer />
}

/**
 * Small utility hook that flips to "visible" after a given delay.
 * Useful to avoid flashing very short Suspense fallbacks.
 * @param {number} [delay=200] - Milliseconds to wait before showing.
 * @returns {boolean} True once the delay has elapsed.
 */
function useDelayedVisible(delay = 200) {
  const [show, setShow] = useState(false)
  useEffect(() => {
    const t = setTimeout(() => setShow(true), delay)
    return () => clearTimeout(t)
  }, [delay])
  return show
}

/**
 * Suspense fallback that appears after a short delay (to reduce flashes).
 * @param {{ delay?: number }} props
 * @returns {JSX.Element | null}
 */
function DelayedFallback({ delay = 200 }: { delay?: number }) {
  const show = useDelayedVisible(delay)
  if (!show) return null
  return (
    &lt;div style={{ padding: '2rem', textAlign: 'center' }}>
      Cargando…
    &lt;/div>
  )
}

/**
 * Root application router. Provides:
 * - Skip Link targeting &lt;main> (WCAG 2.4.1 Bypass Blocks)
 * - Global header and breadcrumbs
 * - Protected and guest-only route guards
 * - Footer visibility based on current route
 * @component
 * @returns {JSX.Element}
 */
export default function AppRouter() {
  return (
    &lt;BrowserRouter>
      {/* WCAG 2.4.1 - Bypass Blocks */}
      &lt;SkipLink />

      &lt;Header />

      {/* Breadcrumbs / page trail */}
      &lt;Breadcrumbs />

      {/* Suspense fallback with small delay (ms) */}
      &lt;Suspense fallback={&lt;DelayedFallback delay={95} />}>
        &lt;main id='main' tabIndex={-1}>
          &lt;Routes>
            &lt;Route path='/auth/callback' element={&lt;AuthCallback />} />

            {/* Protected */}
            &lt;Route path='/' element={&lt;Protected>&lt;Home />&lt;/Protected>} />
            &lt;Route path='/movies' element={&lt;Protected>&lt;Movies />&lt;/Protected>} />
            &lt;Route path='/movie/:id' element={&lt;Protected>&lt;MovieDetail />&lt;/Protected>} />
            &lt;Route path='/account' element={&lt;Protected>&lt;Account />&lt;/Protected>} />
            &lt;Route path='/favorites' element={&lt;Protected>&lt;Favorites />&lt;/Protected>} />
            &lt;Route path='/about' element={&lt;Protected>&lt;About />&lt;/Protected>} />
            &lt;Route path='/site-map' element={&lt;Protected>&lt;SiteMap />&lt;/Protected>} />

            {/* Public */}
            &lt;Route path='/login' element={&lt;GuestOnly>&lt;Login />&lt;/GuestOnly>} />
            &lt;Route path='/register' element={&lt;GuestOnly>&lt;Register />&lt;/GuestOnly>} />
            &lt;Route path='/forgot-password' element={&lt;ForgotPassword />} />
            &lt;Route path='/reset-password' element={&lt;ResetPassword />} />

            &lt;Route path='*' element={&lt;Navigate to='/' replace />} />
          &lt;/Routes>
        &lt;/main>
      &lt;/Suspense>

      &lt;FooterSwitcher />
    &lt;/BrowserRouter>
  )
}
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.5</a> on Sat Oct 25 2025 03:57:12 GMT-0500 (hora estándar de Colombia) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
