<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>routes/AppRouter.tsx - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-Pages_Account.html">Pages/Account</a><ul class='methods'><li data-type='method'><a href="module-Pages_Account.html#~Account">Account</a></li><li data-type='method'><a href="module-Pages_Account.html#~calcAgeFromBirthdate">calcAgeFromBirthdate</a></li><li data-type='method'><a href="module-Pages_Account.html#~pickStr">pickStr</a></li><li data-type='method'><a href="module-Pages_Account.html#~toNum">toNum</a></li></ul></li><li><a href="module-Pages_ForgotPassword.html">Pages/ForgotPassword</a><ul class='methods'><li data-type='method'><a href="module-Pages_ForgotPassword.html#~ForgotPassword">ForgotPassword</a></li></ul></li><li><a href="module-Pages_ResetPassword.html">Pages/ResetPassword</a><ul class='methods'><li data-type='method'><a href="module-Pages_ResetPassword.html#~ResetPassword">ResetPassword</a></li></ul></li><li><a href="module-Pages_SiteMap.html">Pages/SiteMap</a><ul class='methods'><li data-type='method'><a href="module-Pages_SiteMap.html#~SiteMap">SiteMap</a></li></ul></li><li><a href="module-pages_about_About.html">pages/about/About</a><ul class='methods'><li data-type='method'><a href="module-pages_about_About.html#~About">About</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#App">App</a></li><li><a href="global.html#AppRouter">AppRouter</a></li><li><a href="global.html#AppThemeProvider">AppThemeProvider</a></li><li><a href="global.html#AuthCallback">AuthCallback</a></li><li><a href="global.html#Breadcrumbs">Breadcrumbs</a></li><li><a href="global.html#EMAIL_KEY">EMAIL_KEY</a></li><li><a href="global.html#Favorites">Favorites</a></li><li><a href="global.html#FlipCard">FlipCard</a></li><li><a href="global.html#Footer">Footer</a></li><li><a href="global.html#GlobalStyle">GlobalStyle</a></li><li><a href="global.html#Home">Home</a></li><li><a href="global.html#InnerApp">InnerApp</a></li><li><a href="global.html#LABELS">LABELS</a></li><li><a href="global.html#Login">Login</a></li><li><a href="global.html#MOVIE_KEY">MOVIE_KEY</a></li><li><a href="global.html#MovieDetail">MovieDetail</a></li><li><a href="global.html#Movies">Movies</a></li><li><a href="global.html#MoviesPage">MoviesPage</a></li><li><a href="global.html#SkipLink">SkipLink</a></li><li><a href="global.html#Switch">Switch</a></li><li><a href="global.html#TopLoader">TopLoader</a></li><li><a href="global.html#api">api</a></li><li><a href="global.html#authHeaders">authHeaders</a></li><li><a href="global.html#clearToken">clearToken</a></li><li><a href="global.html#darkTheme">darkTheme</a></li><li><a href="global.html#getRandomPexelsVideo">getRandomPexelsVideo</a></li><li><a href="global.html#hasSupabaseAuthParams">hasSupabaseAuthParams</a></li><li><a href="global.html#isAuthed">isAuthed</a></li><li><a href="global.html#isMovieArray">isMovieArray</a></li><li><a href="global.html#lightTheme">lightTheme</a></li><li><a href="global.html#mapNetError">mapNetError</a></li><li><a href="global.html#pathToLabel">pathToLabel</a></li><li><a href="global.html#popFlashToast">popFlashToast</a></li><li><a href="global.html#posterCandidatesFrom">posterCandidatesFrom</a></li><li><a href="global.html#pushFlashToast">pushFlashToast</a></li><li><a href="global.html#request">request</a></li><li><a href="global.html#slugify">slugify</a></li><li><a href="global.html#supa">supa</a></li><li><a href="global.html#themes">themes</a></li><li><a href="global.html#urlJoin">urlJoin</a></li><li><a href="global.html#useDelayedVisible">useDelayedVisible</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">routes/AppRouter.tsx</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// src/routes/AppRouter.tsx
/**
 * @file AppRouter.tsx
 * @description Main application router and layout composition (Header, Breadcrumbs, Footer).
 */

import { BrowserRouter, Routes, Route, Navigate, useLocation } from 'react-router-dom'
import { Suspense, useEffect, useState } from 'react'
import Header from '../components/layout/Header'
import Footer from '../components/layout/Footer'

import Home from '../pages/home/Home'
import Movies from '../pages/movies/Movies'
import MovieDetail from '../pages/movie/MovieDetail'
import Login from '../pages/login/Login'
import Register from '../pages/register/Register'
import ForgotPassword from '../pages/forgot-password/ForgotPassword'
import Account from '../pages/account/Account'
import Favorites from '../pages/favorites/Favorites'
import About from '../pages/about/About'
import SiteMap from '../site-map/SiteMap'

import AuthCallback from '../pages/auth-callback/AuthCallback'
import { hasSupabaseAuthParams } from '../utils/authUrl'
import ResetPassword from '../pages/reset-password/ResetPassword'

import Breadcrumbs from '../components/Breadcrumbs/Breadcrumbs'
import SkipLink from '../components/a11y/SkipLink'

import ErrorBoundary from '../components/error-boundary/ErrorBoundary'
import NotFound from '../pages/not-found/NotFound'

/** Auth gate (token mínimo en localStorage) */
const isAuthed = () => !!localStorage.getItem('token')

function Protected({ children }: { children: JSX.Element }) {
  const location = useLocation()
  if (hasSupabaseAuthParams()) return children
  return isAuthed() ? children : &lt;Navigate to="/login" replace state={{ from: location }} />
}

function GuestOnly({ children }: { children: JSX.Element }) {
  const location = useLocation()
  if (hasSupabaseAuthParams()) return children
  return isAuthed() ? &lt;Navigate to="/" replace state={{ from: location }} /> : children
}

function FooterSwitcher() {
  const { pathname } = useLocation()
  const hide = ['/login', '/register', '/forgot-password', '/reset-password'].includes(pathname)
  return hide ? null : &lt;Footer />
}

/** Delay helper for Suspense fallback */
function useDelayedVisible(delay = 200) {
  const [show, setShow] = useState(false)
  useEffect(() => {
    const t = setTimeout(() => setShow(true), delay)
    return () => clearTimeout(t)
  }, [delay])
  return show
}

function DelayedFallback({ delay = 200 }: { delay?: number }) {
  const show = useDelayedVisible(delay)
  if (!show) return null
  return &lt;div style={{ padding: '2rem', textAlign: 'center' }}>Cargando…&lt;/div>
}

/** Envoltorio que SÍ vive dentro del Router y puede usar useLocation */
function InnerApp() {
  const location = useLocation() // ✅ ahora sí, dentro del Router

  return (
    &lt;>
      {/* WCAG 2.4.1 - Bypass Blocks */}
      &lt;SkipLink />

      &lt;Header />
      &lt;Breadcrumbs />

      &lt;Suspense fallback={&lt;DelayedFallback delay={95} />}>
        &lt;ErrorBoundary resetKeys={[location.pathname]}>
          &lt;main id="main" tabIndex={-1}>
            &lt;Routes>
              &lt;Route path="/auth/callback" element={&lt;AuthCallback />} />

              {/* Protegidas */}
              &lt;Route path="/" element={&lt;Protected>&lt;Home />&lt;/Protected>} />
              &lt;Route path="/movies" element={&lt;Protected>&lt;Movies />&lt;/Protected>} />
              &lt;Route path="/movie/:id" element={&lt;Protected>&lt;MovieDetail />&lt;/Protected>} />
              &lt;Route path="/account" element={&lt;Protected>&lt;Account />&lt;/Protected>} />
              &lt;Route path="/favorites" element={&lt;Protected>&lt;Favorites />&lt;/Protected>} />
              &lt;Route path="/about" element={&lt;Protected>&lt;About />&lt;/Protected>} />
              &lt;Route path="/site-map" element={&lt;Protected>&lt;SiteMap />&lt;/Protected>} />

              {/* Públicas */}
              &lt;Route path="/login" element={&lt;GuestOnly>&lt;Login />&lt;/GuestOnly>} />
              &lt;Route path="/register" element={&lt;GuestOnly>&lt;Register />&lt;/GuestOnly>} />
              &lt;Route path="/forgot-password" element={&lt;ForgotPassword />} />
              &lt;Route path="/reset-password" element={&lt;ResetPassword />} />

              {/* 404 */}
              &lt;Route path="*" element={&lt;NotFound />} />
            &lt;/Routes>
          &lt;/main>
        &lt;/ErrorBoundary>
      &lt;/Suspense>

      &lt;FooterSwitcher />
    &lt;/>
  )
}

/** Root (monta el BrowserRouter una sola vez) */
export default function AppRouter() {
  return (
    &lt;BrowserRouter>
      &lt;InnerApp />
    &lt;/BrowserRouter>
  )
}
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.5</a> on Fri Oct 31 2025 00:48:56 GMT-0500 (hora estándar de Colombia) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
