<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>pages/home/Home.tsx - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-Pages_Account.html">Pages/Account</a><ul class='methods'><li data-type='method'><a href="module-Pages_Account.html#~Account">Account</a></li><li data-type='method'><a href="module-Pages_Account.html#~calcAgeFromBirthdate">calcAgeFromBirthdate</a></li><li data-type='method'><a href="module-Pages_Account.html#~pickStr">pickStr</a></li><li data-type='method'><a href="module-Pages_Account.html#~toNum">toNum</a></li></ul></li><li><a href="module-Pages_ForgotPassword.html">Pages/ForgotPassword</a><ul class='methods'><li data-type='method'><a href="module-Pages_ForgotPassword.html#~ForgotPassword">ForgotPassword</a></li></ul></li><li><a href="module-Pages_ResetPassword.html">Pages/ResetPassword</a><ul class='methods'><li data-type='method'><a href="module-Pages_ResetPassword.html#~ResetPassword">ResetPassword</a></li></ul></li><li><a href="module-Pages_SiteMap.html">Pages/SiteMap</a><ul class='methods'><li data-type='method'><a href="module-Pages_SiteMap.html#~SiteMap">SiteMap</a></li></ul></li><li><a href="module-pages_about_About.html">pages/about/About</a><ul class='methods'><li data-type='method'><a href="module-pages_about_About.html#~About">About</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#App">App</a></li><li><a href="global.html#AppRouter">AppRouter</a></li><li><a href="global.html#AppThemeProvider">AppThemeProvider</a></li><li><a href="global.html#AuthCallback">AuthCallback</a></li><li><a href="global.html#Breadcrumbs">Breadcrumbs</a></li><li><a href="global.html#EMAIL_KEY">EMAIL_KEY</a></li><li><a href="global.html#Favorites">Favorites</a></li><li><a href="global.html#FlipCard">FlipCard</a></li><li><a href="global.html#Footer">Footer</a></li><li><a href="global.html#GlobalStyle">GlobalStyle</a></li><li><a href="global.html#Home">Home</a></li><li><a href="global.html#InnerApp">InnerApp</a></li><li><a href="global.html#LABELS">LABELS</a></li><li><a href="global.html#Login">Login</a></li><li><a href="global.html#MOVIE_KEY">MOVIE_KEY</a></li><li><a href="global.html#MovieDetail">MovieDetail</a></li><li><a href="global.html#Movies">Movies</a></li><li><a href="global.html#MoviesPage">MoviesPage</a></li><li><a href="global.html#SkipLink">SkipLink</a></li><li><a href="global.html#Switch">Switch</a></li><li><a href="global.html#TopLoader">TopLoader</a></li><li><a href="global.html#api">api</a></li><li><a href="global.html#authHeaders">authHeaders</a></li><li><a href="global.html#clearToken">clearToken</a></li><li><a href="global.html#darkTheme">darkTheme</a></li><li><a href="global.html#getRandomPexelsVideo">getRandomPexelsVideo</a></li><li><a href="global.html#hasSupabaseAuthParams">hasSupabaseAuthParams</a></li><li><a href="global.html#isAuthed">isAuthed</a></li><li><a href="global.html#isMovieArray">isMovieArray</a></li><li><a href="global.html#lightTheme">lightTheme</a></li><li><a href="global.html#mapNetError">mapNetError</a></li><li><a href="global.html#pathToLabel">pathToLabel</a></li><li><a href="global.html#popFlashToast">popFlashToast</a></li><li><a href="global.html#posterCandidatesFrom">posterCandidatesFrom</a></li><li><a href="global.html#pushFlashToast">pushFlashToast</a></li><li><a href="global.html#request">request</a></li><li><a href="global.html#slugify">slugify</a></li><li><a href="global.html#supa">supa</a></li><li><a href="global.html#themes">themes</a></li><li><a href="global.html#urlJoin">urlJoin</a></li><li><a href="global.html#useDelayedVisible">useDelayedVisible</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">pages/home/Home.tsx</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @file Home.tsx
 * @description Landing grid that shows a subset of movies.
 * Accessibility notes:
 * - The visible heading is an &lt;h2> for styling, but we expose it as a level-1
 *   heading to assistive tech via role="heading" aria-level={1}.
 * - The heading is marked with [data-skip-target] so the global skip-link
 *   can land here immediately (WCAG 2.4.1 Bypass Blocks).
 * - Clear loading/error/empty states improve UX for everyone.
 */

import { useEffect, useState } from 'react'
import { api } from '../../services/api'      // reuse your existing API client
import MovieCard from '../../components/movie/MovieCard'
import './Home.scss'
import { useToast } from '../../components/toast/ToastProvider' // üî¥ Toasts
import { slugify } from '../../utils/slug' // üëà clave estable por si falta id

/** Minimal shape required by MovieCard */
type Movie = {
  _id?: string
  id?: string | number
  title: string
  year?: number | string
  poster_url?: string
  genres?: string[]
}

/* ===== TopLoader helpers (eventos globales) ===== */
function loaderStart() {
  window.dispatchEvent(new CustomEvent('top-loader', { detail: 'start' }))
}
function loaderStop() {
  window.dispatchEvent(new CustomEvent('top-loader', { detail: 'stop' }))
}

/**
 * @component
 * @returns Landing grid showing a sample of movies plus loading/error states.
 */
export default function Home() {
  // Basic page state
  const [movies, setMovies] = useState&lt;Movie[]>([])
  const [loading, setLoading] = useState(true)
  const [error, setError] = useState&lt;string | null>(null)

  const { error: showErrorToast } = useToast() // üî¥ helper para toast roja

  useEffect(() => {
    let alive = true
      ; (async () => {
        try {
          loaderStart()          // ‚¨ÖÔ∏è START loader
          setLoading(true)
          setError(null)

          // Same endpoint used by /movies; if your API returns { data: [...] },
          // we normalize below to keep a consistent array shape.
          const res = await api.get&lt;any>('/movies')

          // Normalize possible response shapes (array vs { data: [...] })
          const raw: Movie[] = Array.isArray(res) ? res : (res?.data ?? [])

          // Ensure a stable key for MovieCard
          const list = raw.map(m => ({ ...m, _id: m._id ?? (m.id ? String(m.id) : undefined) }))

          if (alive) setMovies(list)
        } catch (e: any) {
          if (!alive) return
          const msg = e?.response?.data?.message || e?.message || 'No se pudieron cargar las pel√≠culas'
          setError(msg)         // estado inline (A11Y)
          showErrorToast(msg)   // üî¥ toast roja
        } finally {
          if (alive) setLoading(false)
          loaderStop()          // ‚¨ÖÔ∏è STOP loader
        }
      })()

    return () => { alive = false }
  }, [showErrorToast])

  return (
    &lt;section className='container home-page'>
      {/**
       * Visible heading kept as &lt;h2> (to match current styles), but exposed
       * as the main page heading to SR using role/aria-level.
       * Marked as [data-skip-target] so the skip-link focuses here.
       */}
      &lt;h2 data-skip-target role="heading" aria-level={1}>Pel√≠culas&lt;/h2>

      {/* Loading skeletons for perceived performance while fetching */}
      {loading &amp;&amp; (
        &lt;div className='grid'>
          {Array.from({ length: 8 }).map((_, i) => (
            &lt;div className='movie-card skeleton' key={i} />
          ))}
        &lt;/div>
      )}

      {/* Short error state; message kept in Spanish to match UI language */}
      {error &amp;&amp; &lt;p role="alert" style={{ color: 'salmon' }}>{error}&lt;/p>}

      {/* Normal render once loaded and not errored */}
      {!loading &amp;&amp; !error &amp;&amp; (
        &lt;div className='grid'>
          {movies.map((m, i) => {
            const year =
              (m as any).year ??
              (typeof (m as any).release_date === 'string' ? (m as any).release_date.slice(0, 4) : '')
            // üëá key estable: usa _id/id/slug y si faltan, t√≠tulo+year+√≠ndice
            const key =
              (m as any)._id ??
              (m as any).id ??
              (m as any).slug ??
              `${slugify(m.title)}-${year}-${i}`

            return &lt;MovieCard key={String(key)} movie={m as any} />
          })}
        &lt;/div>
      )}
    &lt;/section>
  )
}
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.5</a> on Fri Oct 31 2025 00:48:56 GMT-0500 (hora est√°ndar de Colombia) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
