<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>pages/favorites/Favorites.tsx - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-Pages_Account.html">Pages/Account</a><ul class='methods'><li data-type='method'><a href="module-Pages_Account.html#~Account">Account</a></li><li data-type='method'><a href="module-Pages_Account.html#~calcAgeFromBirthdate">calcAgeFromBirthdate</a></li><li data-type='method'><a href="module-Pages_Account.html#~pickStr">pickStr</a></li><li data-type='method'><a href="module-Pages_Account.html#~toNum">toNum</a></li></ul></li><li><a href="module-Pages_ForgotPassword.html">Pages/ForgotPassword</a><ul class='methods'><li data-type='method'><a href="module-Pages_ForgotPassword.html#~ForgotPassword">ForgotPassword</a></li></ul></li><li><a href="module-Pages_ResetPassword.html">Pages/ResetPassword</a><ul class='methods'><li data-type='method'><a href="module-Pages_ResetPassword.html#~ResetPassword">ResetPassword</a></li></ul></li><li><a href="module-Pages_SiteMap.html">Pages/SiteMap</a><ul class='methods'><li data-type='method'><a href="module-Pages_SiteMap.html#~SiteMap">SiteMap</a></li></ul></li><li><a href="module-pages_about_About.html">pages/about/About</a><ul class='methods'><li data-type='method'><a href="module-pages_about_About.html#~About">About</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#AGE_MAX">AGE_MAX</a></li><li><a href="global.html#AGE_MIN">AGE_MIN</a></li><li><a href="global.html#App">App</a></li><li><a href="global.html#AppRouter">AppRouter</a></li><li><a href="global.html#AppThemeProvider">AppThemeProvider</a></li><li><a href="global.html#AuthCallback">AuthCallback</a></li><li><a href="global.html#Breadcrumbs">Breadcrumbs</a></li><li><a href="global.html#DelayedFallback">DelayedFallback</a></li><li><a href="global.html#EMAIL_KEY">EMAIL_KEY</a></li><li><a href="global.html#Favorites">Favorites</a></li><li><a href="global.html#FlipCard">FlipCard</a></li><li><a href="global.html#Footer">Footer</a></li><li><a href="global.html#FooterSwitcher">FooterSwitcher</a></li><li><a href="global.html#GuestOnly">GuestOnly</a></li><li><a href="global.html#Header">Header</a></li><li><a href="global.html#Home">Home</a></li><li><a href="global.html#LABELS">LABELS</a></li><li><a href="global.html#Login">Login</a></li><li><a href="global.html#MovieCard">MovieCard</a></li><li><a href="global.html#MovieDetail">MovieDetail</a></li><li><a href="global.html#MoviesPage">MoviesPage</a></li><li><a href="global.html#PRELOAD_MARGIN">PRELOAD_MARGIN</a></li><li><a href="global.html#Protected">Protected</a></li><li><a href="global.html#Register">Register</a></li><li><a href="global.html#SkipLink">SkipLink</a></li><li><a href="global.html#Switch">Switch</a></li><li><a href="global.html#calcStars">calcStars</a></li><li><a href="global.html#clearToken">clearToken</a></li><li><a href="global.html#getRandomPexelsVideo">getRandomPexelsVideo</a></li><li><a href="global.html#guessPoster">guessPoster</a></li><li><a href="global.html#isAuthed">isAuthed</a></li><li><a href="global.html#isMovieArray">isMovieArray</a></li><li><a href="global.html#pathToLabel">pathToLabel</a></li><li><a href="global.html#useDelayedVisible">useDelayedVisible</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">pages/favorites/Favorites.tsx</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @file Favorites.tsx
 * @summary Lists the user's favorite movies and allows removing entries.
 * @remarks Normalizes heterogeneous favorite payloads so MovieCard receives a consistent shape.
 */
// src/pages/favorites/Favorites.tsx
import { useEffect, useState } from 'react'
import MovieCard from '../../components/movie/MovieCard'
import { Favorites as FavService, Favorite } from '../../services/favorites'
import '../home/Home.scss'
import './Favorites.scss'

type FavMovie = {
  id: string
  title: string
  poster?: string
  posterUrl?: string
  year?: number | string
  genres?: string[] | string
  rating?: number
  avgRating?: number
  vote_average?: number
  release_date?: string
  release_year?: string | number
}

function guessPoster(m: any): string | undefined {
  return (
    m?.poster ||
    m?.posterUrl ||
    m?.poster_url ||
    m?.image ||
    m?.cover ||
    m?.thumbnail ||
    m?.images?.poster
  )
}

function normRating(x: any): number {
  let r = Number(x ?? 0)
  if (Number.isNaN(r)) r = 0
  if (r > 5) r = r / 2
  return Math.max(0, Math.min(5, r))
}

function favToMovie(f: FavMovie) {
  const poster = guessPoster(f)
  return {
    id: f.id,
    title: f.title || 'Sin título',
    poster,
    posterUrl: poster,
    rating: normRating(f.rating ?? f.avgRating ?? f.vote_average ?? 0),
    year:
      f.year ??
      f.release_year ??
      (typeof f.release_date === 'string' ? f.release_date.slice(0, 4) : undefined),
    genres: Array.isArray(f.genres) ? f.genres : (f.genres ? [String(f.genres)] : []),
  } as any
}

/**
 * @component
 * @returns Favorites grid with inline actions to remove items from the saved list.
 */
export default function Favorites() {
  const [items, setItems] = useState&lt;FavMovie[]>([])
  const [loading, setLoading] = useState(true)
  const [error, setError] = useState&lt;string>()
  const [removing, setRemoving] = useState&lt;string | null>(null)

  useEffect(() => {
    let alive = true
      ; (async () => {
        try {
          const data = await FavService.list()
          const arr = Array.isArray(data) ? data : (data as any)?.items ?? []
          const mapped: FavMovie[] = arr.map((r: Favorite | any) => ({
            id: String((r as any).id ?? (r as any).movie_id ?? (r as any).movieId),
            title: (r as any).title ?? (r as any).name ?? '',
            poster: guessPoster(r),
            posterUrl: guessPoster(r),
            rating: (r as any).rating,
            avgRating: (r as any).avgRating ?? (r as any).avg_rating,
            vote_average: (r as any).vote_average,
            year: (r as any).year ?? (r as any).release_year,
            release_date: (r as any).release_date,
            genres: (r as any).genres ?? (r as any).genre ?? [],
          }))
          if (alive) setItems(mapped)
        } catch (e: any) {
          if (alive) setError(e?.message || 'No se pudieron cargar tus favoritos')
        } finally {
          if (alive) setLoading(false)
        }
      })()
    return () => { alive = false }
  }, [])

  async function remove(id: string) {
    try {
      setRemoving(id)
      await FavService.remove(id)
      setItems(prev => prev.filter(m => m.id !== id))
    } catch (e: any) {
      alert(e?.message || 'No se pudo quitar de favoritos')
    } finally {
      setRemoving(null)
    }
  }

  return (
    &lt;section className="home favorites-page">
      &lt;h1 className="title" data-skip-target>Favoritos&lt;/h1>

      {loading &amp;&amp; &lt;p style={{ opacity: .8 }}>Cargando…&lt;/p>}
      {error &amp;&amp; &lt;p style={{ color: 'salmon' }}>{error}&lt;/p>}

      {!loading &amp;&amp; !error &amp;&amp; (
        items.length > 0 ? (
          &lt;div className="grid">
            {items.map(f => {
              const movie = favToMovie(f)
              return (
                &lt;div className="favorite-item" key={f.id}>
                  &lt;MovieCard movie={movie as any} />
                  &lt;button
                    className="btn danger"
                    disabled={removing === f.id}
                    onClick={() => remove(f.id)}
                    aria-busy={removing === f.id || undefined}
                  >
                    {removing === f.id ? 'Quitando…' : 'Quitar de favoritos'}
                  &lt;/button>
                &lt;/div>
              )
            })}
          &lt;/div>
        ) : (
          &lt;p style={{ opacity: .8 }}>
            Aún no tienes favoritos. Ve a una película y pulsa &lt;strong>Añadir a favoritos&lt;/strong>.
          &lt;/p>
        )
      )}
    &lt;/section>
  )
}
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.5</a> on Sat Oct 25 2025 19:19:20 GMT-0500 (hora estándar de Colombia) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
