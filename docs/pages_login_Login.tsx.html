<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>pages/login/Login.tsx - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#AGE_MAX">AGE_MAX</a></li><li><a href="global.html#AGE_MIN">AGE_MIN</a></li><li><a href="global.html#AppRouter">AppRouter</a></li><li><a href="global.html#Breadcrumbs">Breadcrumbs</a></li><li><a href="global.html#DelayedFallback">DelayedFallback</a></li><li><a href="global.html#EMAIL_KEY">EMAIL_KEY</a></li><li><a href="global.html#FooterSwitcher">FooterSwitcher</a></li><li><a href="global.html#GuestOnly">GuestOnly</a></li><li><a href="global.html#Header">Header</a></li><li><a href="global.html#Home">Home</a></li><li><a href="global.html#LABELS">LABELS</a></li><li><a href="global.html#Login">Login</a></li><li><a href="global.html#MovieCard">MovieCard</a></li><li><a href="global.html#MovieDetail">MovieDetail</a></li><li><a href="global.html#PRELOAD_MARGIN">PRELOAD_MARGIN</a></li><li><a href="global.html#Protected">Protected</a></li><li><a href="global.html#Register">Register</a></li><li><a href="global.html#calcStars">calcStars</a></li><li><a href="global.html#clearToken">clearToken</a></li><li><a href="global.html#getRandomPexelsVideo">getRandomPexelsVideo</a></li><li><a href="global.html#guessPoster">guessPoster</a></li><li><a href="global.html#isAuthed">isAuthed</a></li><li><a href="global.html#isMovieArray">isMovieArray</a></li><li><a href="global.html#pathToLabel">pathToLabel</a></li><li><a href="global.html#useDelayedVisible">useDelayedVisible</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">pages/login/Login.tsx</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @file Login.tsx
 * @description Login screen with accessible form, client-side validation and CapsLock hint.
 * Persists the last used email in localStorage to speed up subsequent logins.
 */

import { Link, useNavigate } from 'react-router-dom'
import { useEffect, useRef, useState } from 'react'
import './Login.scss'
import { Auth } from '../../services/auth'

/**
 * LocalStorage key used to remember the last email the user typed.
 * This improves UX without storing sensitive data like passwords.
 * @constant
 */
const EMAIL_KEY = 'last_email'

/**
 * Login page component.
 * Renders an accessible login form, validates on submit,
 * and redirects to the home page on success.
 * @component
 * @returns {JSX.Element}
 */
export default function Login() {
  const navigate = useNavigate()
  const [email, setEmail] = useState(localStorage.getItem(EMAIL_KEY) || '')
  const [password, setPassword] = useState('')
  const [showPwd, setShowPwd] = useState(false)
  const [caps, setCaps] = useState(false)

  const [loading, setLoading] = useState(false)
  const [error, setError] = useState&lt;string | undefined>()
  const errSummaryRef = useRef&lt;HTMLDivElement>(null)
  const emailRef = useRef&lt;HTMLInputElement>(null)
  const pwdRef = useRef&lt;HTMLInputElement>(null)

  // Persist last email typed to speed up future logins
  useEffect(() => { if (email) localStorage.setItem(EMAIL_KEY, email) }, [email])

  const emailOk = /^\S+@\S+\.\S+$/.test(email.trim())
  const canSubmit = emailOk &amp;&amp; password.length > 0 &amp;&amp; !loading

  /**
   * Basic client-side validation.
   * Focuses the first invalid field and sets an error message for the summary.
   * @returns {boolean} True when the form is valid and can be submitted.
   */
  function validate(): boolean {
    if (!emailOk) { setError('El formato del correo no es válido.'); emailRef.current?.focus(); return false }
    if (!password) { setError('Ingresa tu contraseña.'); pwdRef.current?.focus(); return false }
    return true
  }

  /**
   * Handles the submit flow:
   * - clears previous errors
   * - validates fields
   * - calls Auth.login and redirects on success
   * - focuses the error summary on failure
   * @param {React.FormEvent&lt;HTMLFormElement>} e
   * @returns {Promise&lt;void>}
   */
  async function handleSubmit(e: React.FormEvent) {
    e.preventDefault()
    setError(undefined)
    if (!validate()) { errSummaryRef.current?.focus(); return }
    setLoading(true)
    try {
      await Auth.login(email, password)
      navigate('/', { replace: true })
    } catch (err: any) {
      setError(err?.message || 'Error al iniciar sesión')
      errSummaryRef.current?.focus()
    } finally {
      setLoading(false)
    }
  }

  return (
    &lt;section className='auth-screen container'>
      &lt;div className='logo-big' aria-label='PYRA' />
      &lt;h1 className='sr-only'>Iniciar sesión&lt;/h1>

      {error &amp;&amp; (
        &lt;div ref={errSummaryRef} tabIndex={-1} role='alert' className='form-summary form-summary--error'>
          {error}
        &lt;/div>
      )}

      &lt;form className='auth-form' onSubmit={handleSubmit} noValidate>
        &lt;label className='field'>
          &lt;span className='field__label'>Tú correo&lt;/span>
          &lt;input
            ref={emailRef}
            id='login_email'
            type='email'
            required
            autoComplete='email'
            placeholder='Ingresa tu correo electrónico'
            value={email}
            onChange={e => setEmail(e.target.value)}
            aria-describedby='login_email_hint'
            aria-invalid={error?.toLowerCase().includes('correo') ? true : undefined}
          />
          &lt;small id='login_email_hint' className='field__hint italic'>Usa el correo con el que te registraste.&lt;/small>
        &lt;/label>

        &lt;label className='field'>
          &lt;span className='field__label'>Tú contraseña&lt;/span>
          &lt;div className='password-field'>
            &lt;input
              ref={pwdRef}
              id='login_password'
              type={showPwd ? 'text' : 'password'}
              required
              autoComplete='current-password'
              placeholder='Contraseña'
              value={password}
              onChange={e => setPassword(e.target.value)}
              onKeyUp={e => setCaps(e.getModifierState('CapsLock'))}
              aria-describedby='login_pwd_hint'
              aria-invalid={error?.toLowerCase().includes('contrase') ? true : undefined}
            />
            &lt;button
              type='button'
              className='pwd-toggle hit-24'
              aria-pressed={showPwd}
              aria-label={showPwd ? 'Ocultar contraseña' : 'Mostrar contraseña'}
              onClick={() => setShowPwd(!showPwd)}
            >
              {showPwd ? (
                // (same SVG as ResetPassword when show=true)
                &lt;svg viewBox="0 0 24 24" width="20" height="20">
                  &lt;path fill="none" stroke="currentColor" strokeWidth="2" d="M3 3l18 18M10.58 10.58A3 3 0 0012 15a3 3 0 002.42-4.42M9.88 5.09A9.66 9.66 0 0112 5c5.52 0 9.5 4.5 9.5 7-.34.83-1.08 1.99-2.25 3.08M5.06 7.06C3.9 8.15 3.16 9.31 2.82 10.14c0 2.5 3.98 7 9.5 7 .9 0 1.77-.12 2.6-.36" />
                &lt;/svg>
              ) : (
                &lt;svg viewBox="0 0 24 24" width="20" height="20">
                  &lt;path fill="none" stroke="currentColor" strokeWidth="2" d="M1.5 12S5.5 5 12 5s10.5 7 10.5 7-4 7-10.5 7S1.5 12 1.5 12z" />
                  &lt;circle fill="none" stroke="currentColor" strokeWidth="2" cx="12" cy="12" r="3.5" />
                &lt;/svg>
              )}
              &lt;span className="sr-only">{showPwd ? 'Ocultar' : 'Mostrar'}&lt;/span>
            &lt;/button>
          &lt;/div>
          &lt;small id='login_pwd_hint' className='field__hint italic'>
            {caps ? 'Tienes Bloq Mayús activado.' : 'Es sensible a mayúsculas.'}
          &lt;/small>
        &lt;/label>

        &lt;button className='btn primary' type='submit' disabled={!canSubmit}>
          {loading ? 'Entrando...' : 'Iniciar sesión'}
        &lt;/button>
      &lt;/form>

      &lt;p className='muted'>&lt;Link to='/forgot-password'>¿Olvidaste la contraseña?&lt;/Link>&lt;/p>
      &lt;p className='muted'>¿Primera vez en PYRA? &lt;Link to='/register'>Regístrate aquí&lt;/Link>&lt;/p>
    &lt;/section>
  )
}
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.5</a> on Sat Oct 25 2025 03:57:12 GMT-0500 (hora estándar de Colombia) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
